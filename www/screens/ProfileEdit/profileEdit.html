<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../ui-kit/css/bootstrap.css">
    <link rel="stylesheet" href="../../ui-kit/css/styles.css">
    <link rel="stylesheet" href="style.css">
    <title>profileEdit</title>

</head>

<body onload="check_credentials()">
    <form action="#" method="post" enctype="multipart/form-data">
        <div class="screen-hat">
            <button class="btn arrow-back">
                <a href="../Profile/profile.html">
                    <img src="../../ui-kit/svg/arrow_back.svg" alt="arrow-back">
                </a>
            </button>
            <div class="mb-3">
                <h3 class="text-header">
                    Профиль
                </h3>
            </div>
        </div>

        <div class="profile-screen">
            <div class="avatar-area">
                <label for="image" style="cursor:pointer;">
                    <!-- Добавить визуальнуюиндикацию? -->
                    <input type='file' name="image" style="display: none;" id="image" accept="image/jpeg, image/png" />
                    <img id="avatar" src="../../ui-kit/img/avatar.png" alt="roma.jpeg" class="avatar-area__image">
                </label>

                <h3 class="text-bold" id="header-name" style="margin-top: 1rem;">
                    Григорий
                </h3>
            </div>
            <div class="panel d-inline-flex align-items-center mt-3">
                <div class="me-3">
                    <h3 class="text-common">Имя</h3>
                </div>
                <div class="w-100">
                    <input type="text" class="form-control" id="name" placeholder="">
                </div>
            </div>
            <div class="panel d-inline-flex align-items-center">
                <div class="me-3">
                    <h3 class="text-common">Пол</h3>
                </div>
                <div class="w-100">
                    <input type="text" class="form-control" id="gender" placeholder="">
                </div>
            </div>
            <div class="panel d-inline-flex align-items-center">
                <div class="me-3">
                    <h3 class="text-common">Дата рождения</h3>
                </div>
                <div class="me-3">
                    <input type="text" class="form-control" id="birth1" placeholder="Год">
                </div>
                <div class="me-3">
                    <input type="text" class="form-control" id="birth2" placeholder="Месяц">
                </div>
                <div class="w-100">
                    <input type="text" class="form-control" id="birth3" placeholder="День">
                </div>
            </div>
            <div class="panel d-inline-flex align-items-center">
                <div class="me-3">
                    <h3 class="text-common">E-mail</h3>
                </div>
                <div class="w-100">
                    <input type="email" class="form-control" id="login" placeholder="">
                </div>
            </div>
            <div class="panel d-inline-flex align-items-center">
                <div class="me-3">
                    <h3 class="text-common">Телефон</h3>
                </div>
                <div class="w-100">
                    <input type="tel" class="form-control" id="phone" placeholder="">
                </div>
            </div>
            <a href="../ResetPassword/changePassword.html">
                <div class="mt-3 d-flex justify-content-center align-items-center w-100">
                    <div><button type="button" class="btn btn-filled2" onclick="apply_changes()">
                            <p class="btn-text">Сменить пароль</p>
                        </button></div>
                </div>
            </a>
            <div class="mt-3 d-flex justify-content-center align-items-center w-100">
                <div><button type="submit" class="btn btn-filled" onclick="apply_changes()">
                        <p class="btn-text">Сохранить</p>
                    </button></div>
            </div>

        </div>
    </form>
    <script src="../../cordova.js"></script>
    <script src="../api.js"></script>
    <script src="../../ui-kit/js/redirects.js"></script>
    <script src="../../ui-kit/js/deeplinks.js"></script>

    <script>
        const url = 'https://trip.backend.xredday.ru';
        function check_credentials() {
            if (localStorage != undefined) {
                ['name', 'gender', 'login', 'phone', 'birth1', 'birth2', 'birth3'].forEach(el => {
                    if (localStorage.getItem(el) != null && localStorage.getItem(el).length > 0) {
                        document.getElementById(el).value = localStorage.getItem(el);
                    } else {
                        document.getElementById(el).value = '';
                    }
                });
                if (localStorage.getItem('name') != null && localStorage.getItem('name').length > 0) {

                    document.getElementById('header-name').innerHTML = localStorage.getItem('name');
                }
            }
        }

        function apply_changes() {
            if (localStorage != undefined) {
                //['name','sex','birth1','birth2','birth3','email','phone'].forEach(el=>{
                let values = {};
                let value;
                ['name', 'gender', 'dob', 'phone'].forEach(el => {
                    if (el == 'dob') {
                        time = new Date(
                            document.getElementById('birth1').value,
                            document.getElementById('birth2').value,
                            document.getElementById('birth3').value,
                        )
                        value = time.getTime();
                    } else {
                        value = document.getElementById(el).value;
                    }
                    console.log(document.getElementById(el))
                    values[el] = value;
                    localStorage.setItem(el, document.getElementById(el).value);
                });
                api_pupd(auth_key, values).then((a) => {
                    console.log('userdata updated');
                });
                el = document.getElementById('new-prof-pic');
                if (el.value) {

                }
            }
            check_credentials();
            redirect_profile();
        }
        document.addEventListener('deviceready', () => {
            api_userdata(localStorage('auth_key')).then((res)=>{
                if (userdata[1] != null){
                    document.getElementById('avatar').src = `${url}/${userdata[1]}`;
                }
            });
        });
    </script>

</body>

</html>